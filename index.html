<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>history map</title>
    <link href="style.css" rel="stylesheet">
    <link href="bootstrap.min.css" rel="stylesheet">
    <script src="jquery-3.7.1.min.js"></script>
    <script src="d3.v5.min.js"></script>
</head>

<body>
<nav class="navbar navbar-default navbar-fixed-top">

</nav>
<svg id="map" style="width: 2000px;height:100vh">
</svg>
<section class="timeline">
    <ul>
        <li id="1900">1900</li>
        <li id="1945">1945</li>
        <li id="2000">2000</li>
    </ul>
</section>
</body>

<script>

    //创建一个地图投影
    var projection = d3.geoNaturalEarth1()
        /*
        .center([107,31])//设置投影的中心点 经纬度
        .scale(550)//设置缩放因子
        /*.translate([width/2,height/2]);//设置平移偏移量*/

    //创建一个地理路径生成器
    var geoPath = d3.geoPath()
        .projection(projection)//设置地理路径生成器的投影方式

    var color = d3.schemeCategory10;
    var svg=d3.select('#map').selectAll('path')
    function update(geojson){
        projection.fitWidth(2100,geojson)
    }
    function drawmap(data) {
        console.log(data);
        update(data);
            svg.remove();
            svg.data(data.features).enter()
            .append('path')
            .attr('d', geoPath)
            .attr('fill', function (d, i) {
                return color[i % 6];
            })
            .on('mouseover', function (d, i) {
                d3.select(this).attr('fill', 'green');
            })
            .on('mouseout', function (d, i) {
                d3.select(this).attr('fill', color[i % 6]);
            })


        }
    //获取中国地图的json文件
    //利用node.js 在本地起一个http-server
    function get2000() {
        d3.json('geojson/world_2000.geojson').then(drawmap)
    }
    function get1945() {
        d3.json('geojson/world_1945.geojson').then(drawmap)
    }
    function get1900() {
        d3.json('geojson/world_1900.geojson').then(drawmap)
    }
    $("#2000").click(get2000())
    $('#1945').click(get1945)
    $('#1900').click(get1900)
        //新建一个颜色比例尺
       /* var scaleColor = d3.scaleOrdinal()
            .domain(d3.range(data.features.length))
            .range(d3.schemeCategory10);


        //绘制区域
        g.append('g')
            .selectAll('path')
            .data(data.features)
            .enter()
            .append('path')
            .attr('stroke','gray')
            .attr('strok-widht',1)
            .attr('d',function (d,i) {
                return geoPath(d);
            })
            .attr('fill',function (d,i) {
                return scaleColor(i);
            })
            .on('mouseover',function (d,i) {
                d3.select(this).attr('fill','yellow');
            })
            .on('mouseout',function (d,i) {
                d3.select(this).attr('fill',scaleColor(i));
            });

        //绘制文字
        g.append('g')
            .selectAll('text')
            .data(data.features)
            .enter()
            .append('text')
            .attr('font-size',12)
            .attr('text-anchor', 'middle')
            .attr('x',function (d,i) {
                var position = mercator(d.properties.centroid || [0,0]);
                return position[0];
            })
            .attr('y',function (d,i) {
                var position = mercator(d.properties.centroid || [0,0]);
                return position[1];
            })
            .attr('dy',function (d,i) {
                //这里为什么这么写呢，因为澳门和香港重合了，挤到一起了。
                if (d.properties.name === '澳门特别行政区') {
                    return 10;
                }
            })
            .text(function (d,i) {
               return d.properties.name;
            });

    });*/

</script>
<script src="bootstrap.min.js"></script>
</html>